<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vibe Coded Vibe Quiz – Create</title>
  <link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Vibe Coded Vibe Quiz</h1>
      <p id="tagline"></p>
      <div class="row">
        <div class="col">
          <label for="lang">Language / Språk</label>
          <select id="lang">
            <option value="sv">Svenska</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="col">
          <label for="topic" data-i18n="topicLabel">Ämne (valfritt)</label>
          <input id="topic" placeholder="Valfritt ämne (t.ex. Formel 1)" />
        </div>
        <div class="col">
          <label for="players" data-i18n="playersLabel">Antal spelare</label>
          <select id="players">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
      </div>
      <div class="players" style="margin-top:8px">
        <div>
          <label data-i18n="p1">Spelare 1</label>
          <input id="p1" />
          <div class="pill"><span class="dot" style="background: var(--p1)"></span> <span>Blue</span></div>
        </div>
        <div>
          <label data-i18n="p2">Spelare 2</label>
          <input id="p2" />
          <div class="pill"><span class="dot" style="background: var(--p2)"></span> <span>Red</span></div>
        </div>
        <div>
          <label data-i18n="p3">Spelare 3</label>
          <input id="p3" />
          <div class="pill"><span class="dot" style="background: var(--p3)"></span> <span>Green</span></div>
        </div>
        <div>
          <label data-i18n="p4">Spelare 4</label>
          <input id="p4" />
          <div class="pill"><span class="dot" style="background: var(--p4)"></span> <span>Purple</span></div>
        </div>
      </div>
      <div class="controls">
        <button id="createBtn" data-i18n="createGame">Skapa spel</button>
        <button id="joinBtn" class="secondary" data-i18n="joinGame">Gå med i spel</button>
        <input id="roomCode" placeholder="ROOM" style="max-width:180px" />
      </div>
      <p id="share" style="margin-top:8px"></p>
      <p style="color:var(--muted);font-size:14px">Project: <a href="https://github.com/rikardronnkvist/vcvq" target="_blank">VCVQ</a></p>
    </div>
  </div>
  <script src="/i18n.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-Q2ONgQnYLzJQ7j4bQ+1ng0q6hSz4EtnpM6ZPGv3YHGB1Jr2qBNgEH5qjV1Xv7ViY" crossorigin="anonymous"></script>
  <script>
    const socket = io();
    const $ = sel => document.querySelector(sel);
    const langSel = $('#lang');
    const playersSel = $('#players');
    const topicInput = $('#topic');
    const inputs = [$('#p1'), $('#p2'), $('#p3'), $('#p4')];
    const shareP = $('#share');
    const roomInput = $('#roomCode');
    const createBtn = $('#createBtn');
    const joinBtn = $('#joinBtn');
    const tagline = $('#tagline');

    const storedLang = localStorage.getItem('vcvq_lang') || 'sv';
    langSel.value = storedLang;
    setLanguage(storedLang);
    updateDefaults();

    langSel.addEventListener('change', e=>{
      const lang = e.target.value; localStorage.setItem('vcvq_lang', lang); setLanguage(lang); updateDefaults();
    });
    playersSel.addEventListener('change', updateDefaults);

    function updateDefaults(){
      const n = Number(playersSel.value);
      const defaults = {
        sv: ['Driver','Front Passenger','Left Back Passenger','Right Back Passenger'],
        en: ['Driver','Front Passenger','Left Back Passenger','Right Back Passenger']
      };
      const lang = langSel.value;
      inputs.forEach((inp, i)=>{
        inp.value = defaults[lang][i] || '';
        inp.parentElement.style.display = (i < n) ? '' : 'none';
      });
    }

    createBtn.addEventListener('click', ()=>{
      const n = Number(playersSel.value);
      const names = inputs.slice(0,n).map(inp=>inp.value || inp.placeholder || 'Player');
      const lang = langSel.value;
      const topic = topicInput.value || 'General knowledge';
      socket.emit('create_room', { topic, lang, numPlayers: n, names }, (res)=>{
        if(!res?.ok){ alert(res?.error || 'Error'); return; }
        const roomId = res.roomId;
        shareP.textContent = (lang==='sv'? 'Dela länkar till spelare:':'Share links to players:') + ' ' +
          names.map((name,i)=> `${name}: ${location.origin}/game.html?room=${roomId}&player=${i+1}`).join('  ');
        // auto-join as host (no player number)
        location.href = `/game.html?room=${roomId}`;
      });
    });

    joinBtn.addEventListener('click', ()=>{
      const code = roomInput.value.trim();
      if(!code){ alert('Enter room code'); return; }
      location.href = `/game.html?room=${code}`;
    });

  </script>
</body>
</html>