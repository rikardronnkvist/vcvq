<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibe Coded Vibe Quiz</title>
  <link rel="icon" type="image/x-icon" href="logo.ico">
  <link rel="stylesheet" href="styles.css">
  <script src="i18n.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="language-selector">
        <button class="language-flag" id="flag-sv" data-lang="sv">üá∏üá™</button>
        <button class="language-flag" id="flag-en" data-lang="en">üá¨üáß</button>
      </div>
      <img src="logo.png" alt="" id="logoImg" class="logo">
    </header>

    <div class="setup-form">
      <select id="language" style="display: none;">
        <option value="sv">Svenska</option>
        <option value="en">English</option>
      </select>

      <div class="form-group">
        <label for="topic" id="labelTopic">Quiz Topic:</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="topicInput" placeholder="Enter any topic (e.g., Science, Movies, Sports)" style="flex: 1;">
          <div id="topicButtonGroup" class="topic-button-group" style="flex: 1; display: none;"></div>
          <select id="topicDropdown" style="display: none;"></select>
          <button id="randomTopicBtn" class="btn-generate" style="padding: 12px 20px; white-space: nowrap;">üé≤ Random</button>
          <button id="customTopicBtn" class="btn-generate" style="padding: 12px 20px; white-space: nowrap; display: none;">‚úèÔ∏è Custom</button>
        </div>
      </div>

      <div class="form-group form-group-inline">
        <div class="inline-field">
          <label for="playerCount" id="labelPlayerCount">Number of Players:</label>
          <div class="number-selector">
            <button type="button" class="number-btn" id="playerCountDecrease">‚àí</button>
            <div class="number-display" id="playerCountDisplay">2</div>
            <button type="button" class="number-btn" id="playerCountIncrease">+</button>
          </div>
          <select id="playerCount" style="display: none;">
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="inline-field">
          <label for="questionCount" id="labelQuestionCount">Number of Questions:</label>
          <div class="number-selector">
            <button type="button" class="number-btn" id="questionCountDecrease">‚àí</button>
            <div class="number-display" id="questionCountDisplay">10</div>
            <button type="button" class="number-btn" id="questionCountIncrease">+</button>
          </div>
          <select id="questionCount" style="display: none;">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="30">30</option>
            <option value="35">35</option>
            <option value="40">40</option>
            <option value="45">45</option>
            <option value="50">50</option>
          </select>
        </div>
      </div>

      <div id="playerNames">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 id="labelPlayerNames">Player Names:</h3>
          <button id="generateNamesBtn" class="btn-generate"></button>
        </div>
        <div class="player-name-input">
          <label id="labelPlayer1" for="player1">Player 1:</label>
          <input type="text" id="player1" value="">
        </div>
        <div class="player-name-input">
          <label id="labelPlayer2" for="player2">Player 2:</label>
          <input type="text" id="player2" value="">
        </div>
        <div class="player-name-input">
          <label id="labelPlayer3" for="player3">Player 4:</label>
          <input type="text" id="player3" value="">
        </div>
        <div class="player-name-input">
          <label id="labelPlayer4" for="player4">Player 3:</label>
          <input type="text" id="player4" value="">
        </div>
        <div class="player-name-input">
          <label id="labelPlayer5" for="player5">Player 5:</label>
          <input type="text" id="player5" value="">
        </div>
      </div>

      <button id="startBtn" class="btn-primary">Start Quiz</button>
      <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <p id="loadingText">Generating quiz questions...</p>
      </div>
      <div id="error" class="error" style="display: none;"></div>
    </div>
  </div>

  <script>
    // Log client info (resolution and user agent) to server
    (function() {
      const resolution = {
        width: globalThis.screen.width || 0,
        height: globalThis.screen.height || 0
      };
      const viewport = {
        width: globalThis.innerWidth || 0,
        height: globalThis.innerHeight || 0
      };
      
      // Get or store visitor ID
      let visitorId = localStorage.getItem('vcvq_visitor_id');
      
      fetch('/api/log-client-info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          resolution: resolution,
          viewport: viewport,
          page: 'index',
          visitorId: visitorId
        })
      })
      .then(response => response.json())
      .then(data => {
        // Store the visitor ID if server returned a new one
        if (data.visitorId && data.visitorId !== visitorId) {
          localStorage.setItem('vcvq_visitor_id', data.visitorId);
        }
      })
      .catch(() => {
        // Silently fail if logging doesn't work
      });
    })();
    
    // Detect Tesla browser and add class for compatibility
    const ua = navigator.userAgent;
    console.log('[VCVQ] User Agent:', ua);
    const screenWidth = globalThis.screen.width || globalThis.innerWidth || 0;
    const screenHeight = globalThis.screen.height || globalThis.innerHeight || 0;
    
    // Detect Tesla browser by user agent or screen resolution
    // Tesla Model Y: 1180x919, Tesla Model 3/X: 1920x1200
    // Note: 1920x1200 too generic, rely on runtime test instead
    const isTeslaBrowser = /Tesla/i.test(ua) || /QNXBrowser/i.test(ua) || 
                          (screenWidth === 1180 && screenHeight === 919);
    
    if (isTeslaBrowser) {
      document.documentElement.classList.add('tesla-browser');
      console.log('[VCVQ] Tesla browser detected (UA:', /Tesla/i.test(ua), 'Resolution:', screenWidth + 'x' + screenHeight + '), applying compatibility fixes');
    } else {
      console.log('[VCVQ] Not a Tesla browser, using custom dropdown styling');
    }
    
    // All selects are now hidden and controlled by button groups for Tesla compatibility
    const playerNameInputs = document.querySelectorAll('.player-name-input');
    const startBtn = document.getElementById('startBtn');
    const generateNamesBtn = document.getElementById('generateNamesBtn');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const languageSelect = document.getElementById('language');

    let currentLang = 'en';

    // Use position translations from i18n.js instead of duplicating
    function getDefaultName(index, lang) {
      return t(`position${index + 1}`, lang);
    }

    function updatePlayerInputs() {
      const count = Number.parseInt(playerCountSelect.value);
      console.log(`[VCVQ] Updating player inputs for ${count} players`);
      for (const [idx, input] of playerNameInputs.entries()) {
        input.style.display = idx < count ? 'flex' : 'none';
      }
    }

    function updateLanguage() {
      const lang = languageSelect.value;
      currentLang = lang;
      console.log(`[VCVQ] Language changed to: ${lang}`);
      
      // Update flag active states
      for (const flag of document.querySelectorAll('.language-flag')) {
        flag.classList.remove('active');
      }
      document.getElementById(`flag-${lang}`).classList.add('active');
      
      // Update labels
      document.getElementById('logoImg').alt = t('logoAlt', lang);
      document.getElementById('labelTopic').textContent = t('topic', lang) + ':';
      document.getElementById('topicInput').placeholder = t('topicPlaceholder', lang);
      document.getElementById('randomTopicBtn').textContent = t('randomTopic', lang);
      document.getElementById('customTopicBtn').textContent = t('customTopic', lang);
      document.getElementById('labelPlayerCount').textContent = t('numberOfPlayers', lang) + ':';
      document.getElementById('labelQuestionCount').textContent = t('numberOfQuestions', lang) + ':';
      document.getElementById('labelPlayerNames').textContent = t('playerNames', lang) + ':';
      document.getElementById('generateNamesBtn').textContent = t('generateNames', lang);
      startBtn.textContent = t('startQuiz', lang);
      document.getElementById('loadingText').textContent = t('generatingQuiz', lang);
      
      // Update player labels and default names
      for (let i = 1; i <= 5; i++) {
        document.getElementById(`labelPlayer${i}`).textContent = `${t('player', lang)} ${i}:`;
        const input = document.getElementById(`player${i}`);
        // Update if it's empty or matches a position name from either language
        const currentValue = input.value;
        const allPositionNames = [];
        for (let pos = 1; pos <= 5; pos++) {
          allPositionNames.push(t(`position${pos}`, 'sv'), t(`position${pos}`, 'en'));
        }
        if (currentValue === '' || allPositionNames.includes(currentValue)) {
          input.value = getDefaultName(i - 1, lang);
        }
      }
    }

    async function generateRandomTopics() {
      const lang = languageSelect.value;
      const randomTopicBtn = document.getElementById('randomTopicBtn');
      
      console.log(`[VCVQ] Generating 15 random topics in ${lang}`);
      randomTopicBtn.disabled = true;
      
      // Show loading overlay
      loading.style.display = 'flex';
      document.getElementById('loadingText').textContent = t('generatingTopics', lang);
      
      try {
        const visitorId = localStorage.getItem('vcvq_visitor_id');
        const response = await fetch('/api/generate-topic', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ language: lang, count: 15, visitorId: visitorId })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          if (response.status === 503 && errorData.errorCode === 'OVERLOADED') {
            errorDiv.textContent = t('serviceOverloaded', lang);
            errorDiv.style.display = 'block';
            loading.style.display = 'none';
            randomTopicBtn.disabled = false;
            return;
          }
          throw new Error('Failed to generate topics');
        }

        const data = await response.json();
        console.log(`[VCVQ] Generated topics:`, data.topics);
        
        // Hide loading overlay
        loading.style.display = 'none';
        
        // Switch to button group
        const topicInput = document.getElementById('topicInput');
        const topicButtonGroup = document.getElementById('topicButtonGroup');
        const topicDropdown = document.getElementById('topicDropdown');
        const customTopicBtn = document.getElementById('customTopicBtn');
        
        topicInput.style.display = 'none';
        topicButtonGroup.style.display = 'flex';
        topicDropdown.style.display = 'none';
        randomTopicBtn.style.display = 'none';
        customTopicBtn.style.display = 'block';
        
        // HTML escaping function to prevent XSS
        function escapeHtml(text) {
          if (text == null) return '';
          const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
          };
          return String(text).replaceAll(/[&<>"']/g, m => map[m]);
        }
        
        // Populate hidden select for compatibility
        topicDropdown.innerHTML = data.topics.map(topic => 
          `<option value="${escapeHtml(topic)}">${escapeHtml(topic)}</option>`
        ).join('');
        
        // Populate button group
        topicButtonGroup.innerHTML = data.topics.map((topic, idx) => 
          `<button type="button" class="topic-option-btn ${idx === 0 ? 'active' : ''}" data-value="${escapeHtml(topic)}" data-group="topic">${escapeHtml(topic)}</button>`
        ).join('');
        
        // Set first topic as selected by default
        if (data.topics.length > 0) {
          topicDropdown.value = data.topics[0];
        }
        
        // Add click handlers for topic buttons
        for (const btn of topicButtonGroup.querySelectorAll('.topic-option-btn')) {
          btn.addEventListener('click', () => {
            for (const b of topicButtonGroup.querySelectorAll('.topic-option-btn')) {
              b.classList.remove('active');
            }
            btn.classList.add('active');
            topicDropdown.value = btn.dataset.value;
          });
        });
        
        randomTopicBtn.disabled = false;
      } catch (error) {
        console.error('[VCVQ] Error generating topics:', error);
        loading.style.display = 'none';
        randomTopicBtn.textContent = '‚úó';
        setTimeout(() => {
          randomTopicBtn.textContent = t('randomTopic', lang);
          randomTopicBtn.disabled = false;
        }, 1500);
      }
    }

    function switchToCustomTopic() {
      const topicInput = document.getElementById('topicInput');
      const topicButtonGroup = document.getElementById('topicButtonGroup');
      const topicDropdown = document.getElementById('topicDropdown');
      const randomTopicBtn = document.getElementById('randomTopicBtn');
      const customTopicBtn = document.getElementById('customTopicBtn');
      
      topicButtonGroup.style.display = 'none';
      topicDropdown.style.display = 'none';
      topicInput.style.display = 'block';
      customTopicBtn.style.display = 'none';
      randomTopicBtn.style.display = 'block';
      
      topicInput.value = '';
      topicInput.focus();
    }

    function getCurrentTopic() {
      const topicInput = document.getElementById('topicInput');
      const topicButtonGroup = document.getElementById('topicButtonGroup');
      const topicDropdown = document.getElementById('topicDropdown');
      
      if (topicInput.style.display !== 'none') {
        return topicInput.value.trim();
      } else if (topicButtonGroup.style.display === 'none' || topicButtonGroup.style.display === '') {
        return topicDropdown.value || '';
      } else {
        // Using button group - get selected button value
        const selectedBtn = topicButtonGroup.querySelector('.topic-option-btn.active');
        return selectedBtn ? selectedBtn.dataset.value : '';
      }
    }

    async function generatePlayerNames() {
      const count = Number.parseInt(playerCountSelect.value);
      const lang = languageSelect.value;
      const topic = getCurrentTopic();
      
      console.log(`[VCVQ] Generating ${count} AI player names in ${lang} for topic: ${topic}`);
      generateNamesBtn.disabled = true;
      
      // Show loading overlay
      loading.style.display = 'flex';
      document.getElementById('loadingText').textContent = t('generatingPlayerNames', lang);
      
      try {
        const visitorId = localStorage.getItem('vcvq_visitor_id');
        const response = await fetch('/api/generate-player-names', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ language: lang, count, topic, visitorId: visitorId })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          if (response.status === 503 && errorData.errorCode === 'OVERLOADED') {
            errorDiv.textContent = t('serviceOverloaded', lang);
            errorDiv.style.display = 'block';
            loading.style.display = 'none';
            generateNamesBtn.textContent = '‚úó';
            setTimeout(() => {
              generateNamesBtn.textContent = t('generateNames', lang);
              generateNamesBtn.disabled = false;
            }, 1500);
            return;
          }
          throw new Error('Failed to generate names');
        }

        const data = await response.json();
        console.log(`[VCVQ] Received generated names:`, data.names);
        
        // Hide loading overlay
        loading.style.display = 'none';
        
        for (let i = 0; i < count; i++) {
          document.getElementById(`player${i + 1}`).value = data.names[i];
        }
        
        generateNamesBtn.textContent = '‚úì';
        setTimeout(() => {
          generateNamesBtn.textContent = t('generateNames', lang);
          generateNamesBtn.disabled = false;
        }, 1500);
      } catch (error) {
        console.error('[VCVQ] Error generating names:', error);
        loading.style.display = 'none';
        generateNamesBtn.textContent = '‚úó';
        setTimeout(() => {
          generateNamesBtn.textContent = t('generateNames', lang);
          generateNamesBtn.disabled = false;
        }, 1500);
      }
    }

    // Question count state (needs to be accessible globally for restore functionality)
    let currentQuestionCount = 10; // Default value
    
    // Player count state (needs to be accessible globally for restore functionality)
    let currentPlayerCount = 2; // Default value
    
    // Set up button group handlers for all option groups
    function setupButtonGroups() {
      // Player count +/- buttons
      const playerCountDisplay = document.getElementById('playerCountDisplay');
      const playerCountSelect = document.getElementById('playerCount');
      const playerCountDecrease = document.getElementById('playerCountDecrease');
      const playerCountIncrease = document.getElementById('playerCountIncrease');
      
      function updatePlayerCountDisplay() {
        playerCountDisplay.textContent = currentPlayerCount;
        playerCountSelect.value = currentPlayerCount;
        playerCountSelect.dispatchEvent(new Event('change'));
        
        // Update button disabled states
        playerCountDecrease.disabled = currentPlayerCount <= 2;
        playerCountIncrease.disabled = currentPlayerCount >= 5;
      }
      
      playerCountDecrease.addEventListener('click', () => {
        if (currentPlayerCount > 2) {
          currentPlayerCount = Math.max(2, currentPlayerCount - 1);
          updatePlayerCountDisplay();
        }
      });
      
      playerCountIncrease.addEventListener('click', () => {
        if (currentPlayerCount < 5) {
          currentPlayerCount = Math.min(5, currentPlayerCount + 1);
          updatePlayerCountDisplay();
        }
      });
      
      // Initialize display and button states
      updatePlayerCountDisplay();
      
      // Question count +/- buttons
      const questionCountDisplay = document.getElementById('questionCountDisplay');
      const questionCountSelect = document.getElementById('questionCount');
      const questionCountDecrease = document.getElementById('questionCountDecrease');
      const questionCountIncrease = document.getElementById('questionCountIncrease');
      
      function updateQuestionCountDisplay() {
        questionCountDisplay.textContent = currentQuestionCount;
        questionCountSelect.value = currentQuestionCount;
        questionCountSelect.dispatchEvent(new Event('change'));
        
        // Update button disabled states
        questionCountDecrease.disabled = currentQuestionCount <= 5;
        questionCountIncrease.disabled = currentQuestionCount >= 50;
      }
      
      questionCountDecrease.addEventListener('click', () => {
        if (currentQuestionCount > 5) {
          currentQuestionCount = Math.max(5, currentQuestionCount - 5);
          updateQuestionCountDisplay();
        }
      });
      
      questionCountIncrease.addEventListener('click', () => {
        if (currentQuestionCount < 50) {
          currentQuestionCount = Math.min(50, currentQuestionCount + 5);
          updateQuestionCountDisplay();
        }
      });
      
      // Initialize display and button states
      updateQuestionCountDisplay();
    }
    
    // Initialize button groups
    setupButtonGroups();
    
    const playerCountSelect = document.getElementById('playerCount');
    playerCountSelect.addEventListener('change', updatePlayerInputs);
    languageSelect.addEventListener('change', updateLanguage);
    
    // Language flag buttons
    for (const flag of document.querySelectorAll('.language-flag')) {
      flag.addEventListener('click', () => {
        const lang = flag.dataset.lang;
        languageSelect.value = lang;
        updateLanguage();
      });
    });
    
    document.getElementById('randomTopicBtn').addEventListener('click', generateRandomTopics);
    document.getElementById('customTopicBtn').addEventListener('click', switchToCustomTopic);
    generateNamesBtn.addEventListener('click', generatePlayerNames);
    updatePlayerInputs();

    startBtn.addEventListener('click', async () => {
      const topic = getCurrentTopic();
      const playerCount = Number.parseInt(playerCountSelect.value);
      const questionCount = Number.parseInt(document.getElementById('questionCount').value);
      const answerCount = 6; // Fixed to 6 answers
      const language = languageSelect.value;
      
      console.log(`[VCVQ] Starting quiz - Topic: ${topic}, Players: ${playerCount}, Questions: ${questionCount}, Answers: ${answerCount}, Language: ${language}`);
      
      if (!topic) {
        errorDiv.textContent = t('enterTopic', language);
        errorDiv.style.display = 'block';
        return;
      }

      const players = [];
      for (let i = 1; i <= playerCount; i++) {
        const name = document.getElementById(`player${i}`).value.trim();
        players.push({ id: i, name: name || `Player ${i}`, score: 0 });
      }

      errorDiv.style.display = 'none';
      loading.style.display = 'flex';
      document.getElementById('loadingText').textContent = t('generatingQuiz', language);
      startBtn.disabled = true;

      try {
        const visitorId = localStorage.getItem('vcvq_visitor_id');
        const response = await fetch('/api/generate-quiz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            topic, 
            language, 
            numQuestions: questionCount, 
            numAnswers: answerCount,
            visitorId: visitorId
          })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          if (response.status === 503 && errorData.errorCode === 'OVERLOADED') {
            errorDiv.textContent = t('serviceOverloaded', language);
            errorDiv.style.display = 'block';
            loading.style.display = 'none';
            startBtn.disabled = false;
            return;
          }
          throw new Error('Failed to generate quiz');
        }

        const data = await response.json();
        console.log(`[VCVQ] Quiz generated successfully`);
        
        sessionStorage.setItem('gameState', JSON.stringify({
          topic,
          players,
          questions: data.questions,
          currentQuestion: 0,
          currentPlayer: Math.floor(Math.random() * playerCount),
          language,
          numQuestions: questionCount
        }));

        globalThis.location.href = 'game.html';
      } catch (error) {
        console.error('[VCVQ] Error generating quiz:', error);
        errorDiv.textContent = t('generateFailed', language);
        errorDiv.style.display = 'block';
        loading.style.display = 'none';
        startBtn.disabled = false;
      }
    });

    // Check if returning from a game restart
    globalThis.addEventListener('load', () => {
      const restartSettings = sessionStorage.getItem('restartSettings');
      const oldRestartPlayers = sessionStorage.getItem('restartPlayers'); // Backwards compatibility
      
      if (restartSettings) {
        console.log('[VCVQ] Restoring all settings from previous game');
        const settings = JSON.parse(restartSettings);
        
        // Restore language
        document.getElementById('language').value = settings.language || 'en';
        updateLanguage();
        
        // Restore topic
        document.getElementById('topicInput').value = settings.topic || '';
        
        // Restore player count (clamp to valid range 2-5)
        const playerCountValue = settings.players.length || 2;
        currentPlayerCount = Math.max(2, Math.min(5, playerCountValue));
        const playerCountDisplay = document.getElementById('playerCountDisplay');
        const playerCountSelect = document.getElementById('playerCount');
        const playerCountDecrease = document.getElementById('playerCountDecrease');
        const playerCountIncrease = document.getElementById('playerCountIncrease');
        playerCountDisplay.textContent = currentPlayerCount;
        playerCountSelect.value = currentPlayerCount;
        playerCountDecrease.disabled = currentPlayerCount <= 2;
        playerCountIncrease.disabled = currentPlayerCount >= 5;
        
        // Restore question count (clamp to valid range 5-50)
        const questionCountValue = settings.numQuestions || 10;
        currentQuestionCount = Math.max(5, Math.min(50, questionCountValue));
        const questionCountDisplay = document.getElementById('questionCountDisplay');
        const questionCountSelect = document.getElementById('questionCount');
        const questionCountDecrease = document.getElementById('questionCountDecrease');
        const questionCountIncrease = document.getElementById('questionCountIncrease');
        questionCountDisplay.textContent = currentQuestionCount;
        questionCountSelect.value = currentQuestionCount;
        questionCountDecrease.disabled = currentQuestionCount <= 5;
        questionCountIncrease.disabled = currentQuestionCount >= 50;
        
        // Update player inputs visibility
        const event = new Event('change');
        document.getElementById('playerCount').dispatchEvent(event);
        
        // Restore player names
        for (const [idx, player] of settings.players.entries()) {
          document.getElementById(`player${idx + 1}`).value = player.name;
        }
        
        sessionStorage.removeItem('restartSettings');
      } else if (oldRestartPlayers) {
        // Backwards compatibility with old restart method
        console.log('[VCVQ] Restoring players from previous game (old method)');
        const players = JSON.parse(oldRestartPlayers);
        const playerCountValue = players.length || 2;
        currentPlayerCount = Math.max(2, Math.min(5, playerCountValue));
        const playerCountDisplay = document.getElementById('playerCountDisplay');
        const playerCountSelect = document.getElementById('playerCount');
        const playerCountDecrease = document.getElementById('playerCountDecrease');
        const playerCountIncrease = document.getElementById('playerCountIncrease');
        playerCountDisplay.textContent = currentPlayerCount;
        playerCountSelect.value = currentPlayerCount;
        playerCountDecrease.disabled = currentPlayerCount <= 2;
        playerCountIncrease.disabled = currentPlayerCount >= 5;
        
        const event = new Event('change');
        document.getElementById('playerCount').dispatchEvent(event);
        
        for (const [idx, player] of players.entries()) {
          document.getElementById(`player${idx + 1}`).value = player.name;
        }
        
        sessionStorage.removeItem('restartPlayers');
      }
      
      // Initialize button text on page load
      updateLanguage();
    });
  </script>
</body>
</html>
